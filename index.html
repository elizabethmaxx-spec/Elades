<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elades Messenger</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --bg: #0e1621; --panel: #17212b; --blue: #5288c1; --text: #ffffff; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: var(--text); font-family: sans-serif; overflow: hidden; }
        
        /* –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: var(--panel); padding: 30px; border-radius: 20px; width: 85%; max-width: 300px; text-align: center; }
        
        input { width: 100%; padding: 14px; margin: 10px 0; border-radius: 12px; border: 1px solid #333; background: #0e1621; color: white; box-sizing: border-box; font-size: 16px; outline: none; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; background: var(--blue); color: white; font-weight: bold; cursor: pointer; font-size: 16px; -webkit-appearance: none; }

        /* –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω */
        #main-app { display: none; flex-direction: column; height: 100vh; }
        header { background: var(--panel); padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #000; }
        .search-area { background: var(--panel); padding: 10px; display: flex; gap: 8px; }
        
        #chat-window { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-size: cover; }
        
        .bubble { max-width: 80%; padding: 10px 14px; border-radius: 16px; font-size: 15px; line-height: 1.4; word-wrap: break-word; }
        .me { background: #2b5278; align-self: flex-end; border-bottom-right-radius: 4px; }
        .them { background: #182533; align-self: flex-start; border-bottom-left-radius: 4px; }

        .input-panel { background: var(--panel); padding: 12px; display: flex; gap: 10px; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-card">
        <h1 style="color: var(--blue); margin: 0;">Elades</h1>
        <p style="opacity: 0.7; font-size: 14px;">–ü—Ä–∏–¥—É–º–∞–π —Å–≤–æ–π –Ω–∏–∫</p>
        <input type="text" id="reg-nick" placeholder="–ù–∏–∫–Ω–µ–π–º..." autocomplete="off">
        <button class="btn" onclick="startApp()">–ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</button>
    </div>
</div>

<div id="main-app">
    <header>
        <b id="chat-title">Elades</b>
        <span id="my-name" style="color: var(--blue); font-size: 12px;"></span>
    </header>
    <div class="search-area">
        <input type="text" id="find-user" placeholder="–ù–∏–∫ –¥—Ä—É–≥–∞..." style="margin:0; flex:1;">
        <button class="btn" style="width:80px; padding:10px;" onclick="openChat()">–ù–∞–π—Ç–∏</button>
    </div>
    <div id="chat-window"></div>
    <div class="input-panel">
        <input type="text" id="msg-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="margin:0; flex:1;">
        <button class="btn" style="width:60px; padding:10px;" onclick="sendMessage()">üöÄ</button>
    </div>
</div>

<script>
    // –¢–≤–æ–π –∫–æ–Ω—Ñ–∏–≥ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω apiKey –ø–æ —Ç–æ–∫–µ–Ω—É)
    const firebaseConfig = {
        apiKey: "AIzaSyB8Pbrxvhd867uPB2PvhLKZ4LL-3IDBlac",
        authDomain: "message-b6f96.firebaseapp.com",
        databaseURL: "https://message-b6f96-default-rtdb.firebaseio.com",
        projectId: "message-b6f96",
        storageBucket: "message-b6f96.firebasestorage.app",
        messagingSenderId: "612390801353",
        appId: "1:612390801353:web:28b2e3269942dba13f2218"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let myNick = localStorage.getItem('el_user_nick');

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    if (myNick) {
        showApp();
    }

    function startApp() {
        const nick = document.getElementById('reg-nick').value.trim().toLowerCase();
        if (nick.length < 2) return alert("–ú–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞!");
        localStorage.setItem('el_user_nick', nick);
        showApp();
    }

    function showApp() {
        myNick = localStorage.getItem('el_user_nick');
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
        document.getElementById('my-name').innerText = "@" + myNick;
    }

    let chatRef = null;

    function openChat() {
        const target = document.getElementById('find-user').value.trim().toLowerCase();
        if (!target || target === myNick) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –¥—Ä—É–≥–∞!");

        const chatId = [myNick, target].sort().join('_');
        document.getElementById('chat-title').innerText = "–ß–∞—Ç: @" + target;
        
        if (chatRef) chatRef.off(); // –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞—Ä—ã–π —á–∞—Ç, –µ—Å–ª–∏ –±—ã–ª

        chatRef = db.ref('chats/' + chatId);
        chatRef.on('value', snap => {
            const win = document.getElementById('chat-window');
            win.innerHTML = "";
            snap.forEach(child => {
                const m = child.val();
                const div = document.createElement('div');
                div.className = 'bubble ' + (m.u === myNick ? 'me' : 'them');
                div.innerText = m.t;
                win.appendChild(div);
            });
            win.scrollTop = win.scrollHeight;
        });
    }

    function sendMessage() {
        const i = document.getElementById('msg-input');
        const target = document.getElementById('find-user').value.trim().toLowerCase();
        if (!i.value || !target) return;

        const chatId = [myNick, target].sort().join('_');
        db.ref('chats/' + chatId).push({
            u: myNick,
            t: i.value,
            time: Date.now()
        });
        i.value = "";
    }
</script>
</body>
</html>
